# RPS #
 
## Overview ##

Category: [Binary Exploitation](../../)

Topics: Binary Exploitation, picoCTF-2022, Improper Input Validation

## Description ##
Here's a program that plays rock, paper, scissors against you. I hear something good happens if you win 5 times in a row.

## Approach ##
I am provided with a C file called, `game-redacted.c`. Inspecting it, I see that I need to have `play` return `True` 5 times in a row to get the flag:

    printf("\n\n");
        if (play()) {
            wins++;
        } else {
            wins = 0;
        }
    if (wins >= 5) {
        puts("Congrats, here's the flag!");
        puts(flag);
      }

In the `play` function, `tgetinput` function is used to get the user's input.

    printf("Please make your selection (rock/paper/scissors):\n");
    r = tgetinput(player_turn, 100);

The win condition is checked in the `play` function as well, where it will see if the user's input matches one of the strings in the array `loses` ("rock/paper/scissors"). If a matches is found, return `True` (the user wins).

    if (strstr(player_turn, loses[computer_turn])) {
        puts("You win! Play again?");
        return true;
    } else {
        puts("Seems like you didn't win this time. Play again?");
        return false;
    }

The program uses `strstr` to check whether the string `loses[computer_turn]` appears anywhere inside the string `player_turn`. I could type `rock paper scissors` and it would guarantee a win since `strstr` only checked if the expected substring is presented in the user's input. 

    Please make your selection (rock/paper/scissors):
    rock paper scissors
    rock paper scissors
    You played: rock paper scissors
    The computer played: paper
    You win! Play again?
    Congrats, here's the flag!
    picoCTF{50M3_3X7R3M3_1UCK_C85AF58A}

Flag: picoCTF{50M3_3X7R3M3_1UCK_C85AF58A}

## Reflection ## 
Although no memory corruption is involved, this challenge is exploitable due to unsafe string handling and improper input validation. The use of `strstr` instead of strict string comparison allows an attacker to craft input that guarantees a win, resulting in a logical exploit.